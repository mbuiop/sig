<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø± Ø¢Ù†Ù„Ø§ÛŒÙ† | Ø³ÛŒØ³ØªÙ… Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ ÙÙˆÙ‚ Ù…Ø¯Ø±Ù†</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ */
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --dark: #212529;
            --light: #f8f9fa;
            --gray: #6c757d;
            --border-radius: 15px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #4cc9f0, #4361ee);
            --gradient-danger: linear-gradient(135deg, #f72585, #7209b7);
            --gradient-warning: linear-gradient(135deg, #f8961e, #f3722c);
        }

        /* Reset & Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Vazirmatn', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Ù„ÙˆØ¯ÛŒÙ†Ú¯ */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ØµÙØ­Ù‡ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª */
        #authContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 40px;
            width: 100%;
            max-width: 450px;
            text-align: center;
            animation: slideUp 0.6s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-logo {
            font-size: 60px;
            margin-bottom: 20px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .auth-title {
            font-size: 28px;
            font-weight: 900;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .auth-subtitle {
            color: var(--gray);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        /* ÙØ±Ù…â€ŒÙ‡Ø§ */
        .form-group {
            margin-bottom: 25px;
            text-align: right;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--dark);
            font-size: 15px;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: var(--transition);
            background: #f8f9fa;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.1);
        }

        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¯Ø±Ù† */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px 32px;
            border-radius: 12px;
            border: none;
            font-weight: 800;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .btn:hover::before {
            transform: translateX(100%);
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.6);
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
            box-shadow: 0 8px 25px rgba(76, 201, 240, 0.4);
        }

        .btn-danger {
            background: var(--gradient-danger);
            color: white;
            box-shadow: 0 8px 25px rgba(247, 37, 133, 0.4);
        }

        .btn-warning {
            background: var(--gradient-warning);
            color: white;
            box-shadow: 0 8px 25px rgba(248, 150, 30, 0.4);
        }

        .btn-secondary {
            background: white;
            color: var(--dark);
            border: 2px solid #e0e0e0;
        }

        .btn-secondary:hover {
            background: #f8f9fa;
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 10px 20px;
            font-size: 14px;
            gap: 8px;
        }

        .btn-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: var(--transition);
        }

        /* Ú©Ø¯ OTP */
        .otp-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }

        .otp-input {
            width: 60px;
            height: 70px;
            text-align: center;
            font-size: 28px;
            font-weight: 900;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            transition: var(--transition);
            background: white;
        }

        .otp-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.1);
            outline: none;
        }

        /* Ø³ÛŒØ³ØªÙ… Ø§ØµÙ„ÛŒ */
        #mainContainer {
            display: none;
            opacity: 0;
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* Ù‡Ø¯Ø± */
        .main-header {
            background: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: var(--gradient-primary);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .logo-text h1 {
            font-size: 24px;
            font-weight: 900;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .logo-text p {
            color: var(--gray);
            font-size: 13px;
        }

        /* Ú©Ø§Ø±Ø¨Ø± */
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px 20px;
            background: #f8f9fa;
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .user-info:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 900;
            font-size: 20px;
        }

        /* Ù†Ø§ÙˆØ¨Ø±ÛŒ */
        .main-nav {
            display: flex;
            gap: 10px;
            padding: 15px 30px;
            background: white;
            border-bottom: 1px solid #e0e0e0;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .main-nav::-webkit-scrollbar {
            display: none;
        }

        .nav-btn {
            padding: 14px 28px;
            border-radius: 12px;
            border: none;
            background: #f8f9fa;
            color: var(--gray);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 15px;
        }

        .nav-btn:hover {
            background: #e9ecef;
            color: var(--dark);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        /* Ù…Ø­ØªÙˆØ§ */
        .content {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        /* Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--gradient-primary);
        }

        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 900;
            color: var(--dark);
        }

        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .card-value {
            font-size: 36px;
            font-weight: 900;
            margin: 15px 0;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .card-value.positive {
            background: var(--gradient-success);
            -webkit-background-clip: text;
            background-clip: text;
        }

        .card-value.negative {
            background: var(--gradient-danger);
            -webkit-background-clip: text;
            background-clip: text;
        }

        /* Ø¬Ø¯ÙˆÙ„â€ŒÙ‡Ø§ */
        .table-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            margin-top: 30px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        th {
            background: #f8f9fa;
            padding: 18px;
            text-align: right;
            font-weight: 900;
            color: var(--dark);
            border-bottom: 2px solid #e0e0e0;
            position: sticky;
            top: 0;
        }

        td {
            padding: 18px;
            border-bottom: 1px solid #f0f0f0;
            transition: var(--transition);
        }

        tr:hover td {
            background: rgba(67, 97, 238, 0.05);
            transform: translateX(5px);
        }

        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª */
        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            width: 42px;
            height: 42px;
            border-radius: 10px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
        }

        .btn-edit {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }

        .btn-edit:hover {
            background: rgba(67, 97, 238, 0.2);
            transform: scale(1.1);
        }

        .btn-delete {
            background: rgba(247, 37, 133, 0.1);
            color: var(--danger);
        }

        .btn-delete:hover {
            background: rgba(247, 37, 133, 0.2);
            transform: scale(1.1);
        }

        .btn-download {
            background: rgba(76, 201, 240, 0.1);
            color: var(--success);
        }

        .btn-download:hover {
            background: rgba(76, 201, 240, 0.2);
            transform: scale(1.1);
        }

        .btn-view {
            background: rgba(114, 9, 183, 0.1);
            color: var(--secondary);
        }

        .btn-view:hover {
            background: rgba(114, 9, 183, 0.2);
            transform: scale(1.1);
        }

        /* ÙØ±Ù… ÙØ§Ú©ØªÙˆØ± */
        .invoice-form {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 35px;
            margin-bottom: 30px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }

        .invoice-items {
            margin: 30px 0;
        }

        .invoice-item {
            display: flex;
            gap: 15px;
            align-items: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 15px;
            transition: var(--transition);
        }

        .invoice-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .item-input {
            flex: 1;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            transition: var(--transition);
        }

        .item-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        /* Ú†Øª */
        .chat-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            height: 600px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            padding: 25px;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h3 {
            font-size: 20px;
            font-weight: 900;
        }

        .chat-messages {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background: #f8f9fa;
        }

        .message {
            max-width: 70%;
            padding: 18px;
            border-radius: 20px;
            position: relative;
            animation: messageSlide 0.3s ease;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.sent {
            background: var(--gradient-primary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .message.received {
            background: white;
            color: var(--dark);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .message-time {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 8px;
            text-align: left;
        }

        .chat-input-area {
            padding: 20px;
            border-top: 1px solid #e0e0e0;
            background: white;
            display: flex;
            gap: 15px;
        }

        .chat-input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            transition: var(--transition);
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .file-upload-btn {
            position: relative;
            overflow: hidden;
        }

        .file-upload-btn input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        /* Ù…Ø¯Ø§Ù„ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 40px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: var(--transition);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.2);
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        /* Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: white;
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 20px;
            z-index: 3000;
            transform: translateX(150%);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border-right: 5px solid var(--primary);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-right-color: #2d9a0f;
        }

        .notification.error {
            border-right-color: #f72585;
        }

        .notification.warning {
            border-right-color: #f8961e;
        }

        /* Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ ÙØ§Ú©ØªÙˆØ± */
        .invoice-preview {
            background: white;
            border-radius: var(--border-radius);
            padding: 40px;
            margin: 30px 0;
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }

        .invoice-preview::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: var(--gradient-primary);
        }

        .invoice-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .invoice-header h2 {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 10px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .invoice-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .invoice-total {
            text-align: left;
            font-size: 28px;
            font-weight: 900;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 3px solid #e0e0e0;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* ØªÚ¯â€ŒÙ‡Ø§ */
        .tag {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 800;
            margin: 5px;
        }

        .tag-success {
            background: rgba(45, 154, 15, 0.1);
            color: #2d9a0f;
        }

        .tag-warning {
            background: rgba(248, 150, 30, 0.1);
            color: #f8961e;
        }

        .tag-danger {
            background: rgba(247, 37, 133, 0.1);
            color: #f72585;
        }

        .tag-primary {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }

        /* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
        @media (max-width: 768px) {
            .content {
                padding: 15px;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .main-header {
                flex-direction: column;
                gap: 20px;
                padding: 15px;
            }
            
            .invoice-item {
                flex-direction: column;
                gap: 10px;
            }
            
            .action-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .chat-container {
                height: 500px;
            }
            
            .modal-content {
                padding: 25px;
                width: 95%;
            }
        }

        @media (max-width: 480px) {
            .auth-card {
                padding: 25px;
            }
            
            .otp-input {
                width: 50px;
                height: 60px;
                font-size: 24px;
            }
            
            .btn {
                padding: 14px 20px;
                font-size: 14px;
            }
            
            .card {
                padding: 20px;
            }
            
            .card-value {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <!-- Ù„ÙˆØ¯ÛŒÙ†Ú¯ -->
    <div id="loadingScreen">
        <div class="loading-spinner"></div>
        <h2 style="color: white; margin-top: 20px; font-weight: 900;">ğŸš€ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø± Ø¢Ù†Ù„Ø§ÛŒÙ†</h2>
        <p style="color: rgba(255, 255, 255, 0.9); margin-top: 10px;">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³ÛŒØ³ØªÙ…...</p>
    </div>

    <!-- ØµÙØ­Ù‡ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª -->
    <div id="authContainer">
        <div class="auth-card">
            <div class="auth-logo">
                <i class="fas fa-calculator"></i>
            </div>
            <h1 class="auth-title">Ø­Ø³Ø§Ø¨Ø¯Ø§Ø± Ø¢Ù†Ù„Ø§ÛŒÙ†</h1>
            <p class="auth-subtitle">Ø³ÛŒØ³ØªÙ… Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ ÙÙˆÙ‚ Ù…Ø¯Ø±Ù† Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ù…Ù„</p>
            
            <!-- Ù…Ø±Ø­Ù„Ù‡ 1: Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† -->
            <div id="phoneStep">
                <div class="form-group">
                    <label class="form-label">ğŸ“± Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„</label>
                    <input type="tel" class="form-input" id="phoneNumber" placeholder="09123456789" maxlength="11">
                </div>
                <button class="btn btn-primary" onclick="sendOTP()">
                    <i class="fas fa-paper-plane"></i>
                    Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯ ØªØ§ÛŒÛŒØ¯
                </button>
            </div>
            
            <!-- Ù…Ø±Ø­Ù„Ù‡ 2: Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ -->
            <div id="otpStep" style="display: none;">
                <div class="form-group">
                    <label class="form-label">ğŸ” Ú©Ø¯ Ûµ Ø±Ù‚Ù…ÛŒ</label>
                    <div class="otp-container">
                        <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 1)">
                        <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 2)">
                        <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 3)">
                        <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 4)">
                        <input type="text" class="otp-input" maxlength="1" oninput="moveToNext(this, 5)">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="verifyOTP()">
                    <i class="fas fa-check-circle"></i>
                    ØªØ§ÛŒÛŒØ¯ Ùˆ ÙˆØ±ÙˆØ¯
                </button>
                <button class="btn btn-secondary" onclick="resendOTP()" style="margin-top: 15px;">
                    <i class="fas fa-redo"></i>
                    Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ Ú©Ø¯
                </button>
            </div>
        </div>
    </div>

    <!-- Ø³ÛŒØ³ØªÙ… Ø§ØµÙ„ÛŒ -->
    <div id="mainContainer">
        <!-- Ù‡Ø¯Ø± -->
        <header class="main-header">
            <div class="header-left">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <div class="logo-text">
                        <h1>Ø­Ø³Ø§Ø¨Ø¯Ø§Ø± Ø¢Ù†Ù„Ø§ÛŒÙ†</h1>
                        <p>Ø³ÛŒØ³ØªÙ… Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ ÙÙˆÙ‚ Ù…Ø¯Ø±Ù†</p>
                    </div>
                </div>
            </div>
            
            <div class="user-info" onclick="showUserMenu()">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div style="text-align: left;">
                    <div style="font-weight: 900; font-size: 16px;" id="userName">Ú©Ø§Ø±Ø¨Ø± Ø³ÛŒØ³ØªÙ…</div>
                    <div style="font-size: 13px; color: var(--gray);" id="userPhoneDisplay">09123456789</div>
                </div>
                <i class="fas fa-chevron-down"></i>
            </div>
        </header>

        <!-- Ù†Ø§ÙˆØ¨Ø±ÛŒ -->
        <div class="main-nav">
            <button class="nav-btn active" onclick="showSection('dashboard')">
                <i class="fas fa-home"></i> Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
            </button>
            <button class="nav-btn" onclick="showSection('customers')">
                <i class="fas fa-users"></i> Ù…Ø´ØªØ±ÛŒØ§Ù†
            </button>
            <button class="nav-btn" onclick="showSection('invoices')">
                <i class="fas fa-file-invoice"></i> ÙØ§Ú©ØªÙˆØ±Ù‡Ø§
            </button>
            <button class="nav-btn" onclick="showSection('products')">
                <i class="fas fa-boxes"></i> Ù…Ø­ØµÙˆÙ„Ø§Øª
            </button>
            <button class="nav-btn" onclick="showSection('checks')">
                <i class="fas fa-money-check-alt"></i> Ú†Ú©â€ŒÙ‡Ø§
            </button>
            <button class="nav-btn" onclick="showSection('chat')">
                <i class="fas fa-comments"></i> Ú†Øª Ø¢Ù†Ù„Ø§ÛŒÙ†
            </button>
            <button class="nav-btn" onclick="showSection('reports')">
                <i class="fas fa-chart-bar"></i> Ú¯Ø²Ø§Ø±Ø´Ø§Øª
            </button>
            <button class="nav-btn" onclick="showSection('settings')">
                <i class="fas fa-cog"></i> ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            </button>
        </div>

        <!-- Ù…Ø­ØªÙˆØ§ -->
        <div class="content">
            <!-- Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
            <div class="content-section active" id="dashboardSection">
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ’° Ø¯Ø±Ø¢Ù…Ø¯ Ø§Ù…Ø±ÙˆØ²</h3>
                            <div class="card-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                        </div>
                        <div class="card-value positive" id="todayIncome">Û° ØªÙˆÙ…Ø§Ù†</div>
                        <p><i class="fas fa-arrow-up" style="color: #2d9a0f;"></i> Ø§ÙØ²Ø§ÛŒØ´ <span id="incomeChange">Û°Ùª</span></p>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ’¸ Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ù…Ø±ÙˆØ²</h3>
                            <div class="card-icon" style="background: var(--gradient-danger);">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                        </div>
                        <div class="card-value negative" id="todayExpense">Û° ØªÙˆÙ…Ø§Ù†</div>
                        <p><i class="fas fa-arrow-down" style="color: #2d9a0f;"></i> Ú©Ø§Ù‡Ø´ <span id="expenseChange">Û°Ùª</span></p>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ“ˆ Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ</h3>
                            <div class="card-icon" style="background: var(--gradient-success);">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="card-value positive" id="todayProfit">Û° ØªÙˆÙ…Ø§Ù†</div>
                        <p><i class="fas fa-star" style="color: #f8961e;"></i> Ø±Ø´Ø¯ <span id="profitChange">Û°Ùª</span></p>
                    </div>
                </div>

                <div class="table-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <h3 style="font-size: 22px; font-weight: 900;">ğŸ“Š ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±</h3>
                        <button class="btn btn-sm btn-primary" onclick="loadTransactions()">
                            <i class="fas fa-sync"></i> Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
                        </button>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Ø±Ø¯ÛŒÙ</th>
                                <th>ØªØ§Ø±ÛŒØ®</th>
                                <th>Ù†ÙˆØ¹</th>
                                <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
                                <th>Ù…Ø¨Ù„Øº</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="recentTransactions">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px;">
                                    <i class="fas fa-spinner fa-spin"></i> Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Ù…Ø´ØªØ±ÛŒØ§Ù† -->
            <div class="content-section" id="customersSection">
                <div class="table-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <h3 style="font-size: 22px; font-weight: 900;">ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø´ØªØ±ÛŒØ§Ù†</h3>
                        <div style="display: flex; gap: 15px;">
                            <button class="btn btn-sm btn-primary" onclick="showAddCustomerModal()">
                                <i class="fas fa-plus"></i> Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø´ØªØ±ÛŒ
                            </button>
                            <button class="btn btn-sm btn-success" onclick="loadCustomers()">
                                <i class="fas fa-sync"></i> Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 25px;">
                        <input type="text" class="form-input" placeholder="ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø´ØªØ±ÛŒ..." 
                               oninput="searchCustomers(this.value)" style="max-width: 400px;">
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Ø±Ø¯ÛŒÙ</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</th>
                                <th>Ø§ÛŒÙ…ÛŒÙ„</th>
                                <th>Ù…Ø§Ù†Ø¯Ù‡ Ø­Ø³Ø§Ø¨</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="customersTable">
                            <!-- Ù…Ø´ØªØ±ÛŒØ§Ù† Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ -->
            <div class="content-section" id="invoicesSection">
                <div class="invoice-form">
                    <h3 style="margin-bottom: 25px; font-size: 22px; font-weight: 900;">ğŸ§¾ Ø§ÛŒØ¬Ø§Ø¯ ÙØ§Ú©ØªÙˆØ± Ø¬Ø¯ÛŒØ¯</h3>
                    
                    <div class="form-row">
                        <div>
                            <label class="form-label">Ù…Ø´ØªØ±ÛŒ</label>
                            <select class="form-input" id="invoiceCustomer">
                                <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">ØªØ§Ø±ÛŒØ® ÙØ§Ú©ØªÙˆØ±</label>
                            <input type="date" class="form-input" id="invoiceDate" value="">
                        </div>
                    </div>

                    <h4 style="margin: 25px 0 15px; font-weight: 900; font-size: 18px;">ğŸ›ï¸ Ø§Ù‚Ù„Ø§Ù… ÙØ§Ú©ØªÙˆØ±</h4>
                    <div class="invoice-items" id="invoiceItems">
                        <div class="invoice-item">
                            <input type="text" class="item-input" placeholder="Ù†Ø§Ù… Ú©Ø§Ù„Ø§" oninput="calculateInvoice()">
                            <input type="number" class="item-input" placeholder="ØªØ¹Ø¯Ø§Ø¯" style="width: 120px;" oninput="calculateInvoice()">
                            <input type="number" class="item-input" placeholder="Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯" style="width: 150px;" oninput="calculateInvoice()">
                            <input type="number" class="item-input" placeholder="ØªØ®ÙÛŒÙ %" style="width: 100px;" oninput="calculateInvoice()">
                            <button class="action-btn btn-delete" onclick="removeInvoiceItem(this)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 25px;">
                        <button class="btn btn-sm btn-primary" onclick="addInvoiceItem()">
                            <i class="fas fa-plus"></i> Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù„Ø§
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="clearInvoiceForm()">
                            <i class="fas fa-eraser"></i> Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†
                        </button>
                    </div>

                    <div style="background: #f8f9fa; padding: 25px; border-radius: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="font-weight: 900; font-size: 18px;">Ø¬Ù…Ø¹ Ú©Ù„ ÙØ§Ú©ØªÙˆØ±:</h4>
                            <h3 style="font-size: 28px; font-weight: 900; color: var(--primary);" id="invoiceTotal">Û° ØªÙˆÙ…Ø§Ù†</h3>
                        </div>
                        <div style="color: var(--gray); font-size: 16px;" id="invoiceTotalWords">ØµÙØ± ØªÙˆÙ…Ø§Ù†</div>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="saveInvoice()">
                            <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ ÙØ§Ú©ØªÙˆØ±
                        </button>
                        <button class="btn btn-success" onclick="downloadInvoiceImage()">
                            <i class="fas fa-download"></i> Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¹Ú©Ø³
                        </button>
                        <button class="btn btn-warning" onclick="sendInvoice()">
                            <i class="fas fa-paper-plane"></i> Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ù…Ø´ØªØ±ÛŒ
                        </button>
                        <button class="btn btn-secondary" onclick="printInvoice()">
                            <i class="fas fa-print"></i> Ú†Ø§Ù¾ ÙØ§Ú©ØªÙˆØ±
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <h3 style="margin-bottom: 25px; font-size: 22px; font-weight: 900;">ğŸ“‹ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Ø´Ù…Ø§Ø±Ù‡ ÙØ§Ú©ØªÙˆØ±</th>
                                <th>ØªØ§Ø±ÛŒØ®</th>
                                <th>Ù…Ø´ØªØ±ÛŒ</th>
                                <th>Ù…Ø¨Ù„Øº</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="invoicesTable">
                            <!-- ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Ú†Øª Ø¢Ù†Ù„Ø§ÛŒÙ† -->
            <div class="content-section" id="chatSection">
                <div class="chat-container">
                    <div class="chat-header">
                        <div>
                            <h3>ğŸ’¬ Ú†Øª Ø¢Ù†Ù„Ø§ÛŒÙ†</h3>
                            <p style="opacity: 0.9; font-size: 14px;">Ú¯ÙØªÚ¯ÙˆÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ø§ Ù…Ø´ØªØ±ÛŒØ§Ù†</p>
                        </div>
                        <select id="chatCustomer" class="form-input" style="width: 250px; background: rgba(255, 255, 255, 0.2); color: white; border-color: rgba(255, 255, 255, 0.3);">
                            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ Ø¨Ø±Ø§ÛŒ Ú†Øª</option>
                        </select>
                    </div>
                    
                    <div class="chat-messages" id="chatMessages">
                        <div style="text-align: center; color: var(--gray); padding: 40px;">
                            <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 20px;"></i>
                            <h4 style="font-weight: 900; margin-bottom: 10px;">Ú¯ÙØªÚ¯Ùˆ Ø±Ø§ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯</h4>
                            <p>ÛŒÚ© Ù…Ø´ØªØ±ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯Ù‡ Ùˆ Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯</p>
                        </div>
                    </div>
                    
                    <div class="chat-input-area">
                        <input type="text" class="chat-input" id="chatMessageInput" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." 
                               onkeypress="if(event.key === 'Enter') sendChatMessage()">
                        
                        <div class="file-upload-btn">
                            <button class="btn btn-icon btn-primary">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <input type="file" id="fileUpload" onchange="uploadFileToChat(this)">
                        </div>
                        
                        <button class="btn btn-icon btn-success" onclick="sendChatMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Ù…Ø­ØµÙˆÙ„Ø§Øª -->
            <div class="content-section" id="productsSection">
                <div class="table-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <h3 style="font-size: 22px; font-weight: 900;">ğŸ“¦ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØµÙˆÙ„Ø§Øª</h3>
                        <div style="display: flex; gap: 15px;">
                            <button class="btn btn-sm btn-primary" onclick="showAddProductModal()">
                                <i class="fas fa-plus"></i> Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„
                            </button>
                            <button class="btn btn-sm btn-success" onclick="loadProducts()">
                                <i class="fas fa-sync"></i> Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
                            </button>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap;">
                        <button class="btn btn-sm" onclick="filterProducts('all')">Ù‡Ù…Ù‡</button>
                        <button class="btn btn-sm" onclick="filterProducts('vegetable')">ØªØ±Ù‡ Ø¨Ø§Ø±</button>
                        <button class="btn btn-sm" onclick="filterProducts('clothing')">Ù¾ÙˆØ´Ø§Ú©</button>
                        <button class="btn btn-sm" onclick="filterProducts('other')">Ø³Ø§ÛŒØ±</button>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Ø±Ø¯ÛŒÙ</th>
                                <th>Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</th>
                                <th>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th>
                                <th>Ù…ÙˆØ¬ÙˆØ¯ÛŒ</th>
                                <th>Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯</th>
                                <th>Ù‚ÛŒÙ…Øª ÙØ±ÙˆØ´</th>
                                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="productsTable">
                            <!-- Ù…Ø­ØµÙˆÙ„Ø§Øª Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§ -->
    <div class="modal" id="addCustomerModal">
        <div class="modal-content">
            <h3 style="margin-bottom: 25px; font-size: 24px; font-weight: 900;">â• Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯</h3>
            
            <div class="form-group">
                <label class="form-label">Ù†Ø§Ù… Ú©Ø§Ù…Ù„</label>
                <input type="text" class="form-input" id="customerName">
            </div>
            
            <div class="form-group">
                <label class="form-label">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
                <input type="tel" class="form-input" id="customerPhone">
            </div>
            
            <div class="form-group">
                <label class="form-label">Ø§ÛŒÙ…ÛŒÙ„</label>
                <input type="email" class="form-input" id="customerEmail">
            </div>
            
            <div class="form-group">
                <label class="form-label">Ø¢Ø¯Ø±Ø³</label>
                <textarea class="form-input" id="customerAddress" rows="3"></textarea>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button class="btn btn-primary" onclick="saveCustomer()" style="flex: 1;">
                    <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ Ù…Ø´ØªØ±ÛŒ
                </button>
                <button class="btn btn-secondary" onclick="closeModal('addCustomerModal')" style="flex: 1;">
                    <i class="fas fa-times"></i> Ø§Ù†ØµØ±Ø§Ù
                </button>
            </div>
        </div>
    </div>

    <!-- Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† -->
    <div class="notification" id="notification">
        <i class="fas fa-info-circle" style="font-size: 24px;"></i>
        <div style="flex: 1;">
            <div id="notificationTitle" style="font-weight: 900; margin-bottom: 5px;">Ø§Ø¹Ù„Ø§Ù† Ø³ÛŒØ³ØªÙ…</div>
            <div id="notificationMessage">Ù¾ÛŒØ§Ù… Ø³ÛŒØ³ØªÙ…</div>
        </div>
        <button class="btn-icon" onclick="closeNotification()" style="background: transparent;">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <script>
        // ==================== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ ====================
        let currentUser = null;
        let authToken = null;
        let socket = null;
        let currentChatRoom = null;

        // ==================== ØªÙˆØ§Ø¨Ø¹ Ø¹Ù…ÙˆÙ…ÛŒ ====================
        function showNotification(title, message, type = 'info') {
            const notification = document.getElementById('notification');
            const titleEl = document.getElementById('notificationTitle');
            const messageEl = document.getElementById('notificationMessage');
            
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        function closeNotification() {
            document.getElementById('notification').classList.remove('show');
        }

        function showLoading(show) {
            const loadingScreen = document.getElementById('loadingScreen');
            loadingScreen.style.display = show ? 'flex' : 'none';
        }

        // ==================== Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª ====================
        function sendOTP() {
            const phone = document.getElementById('phoneNumber').value.trim();
            
            if (!phone || phone.length !== 11) {
                showNotification('Ø®Ø·Ø§', 'Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }

            showLoading(true);
            
            fetch('/api/auth/send-otp', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ phone: phone })
            })
            .then(response => response.json())
            .then(data => {
                showLoading(false);
                
                if (data.success) {
                    document.getElementById('phoneStep').style.display = 'none';
                    document.getElementById('otpStep').style.display = 'block';
                    showNotification('Ù…ÙˆÙÙ‚', 'Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ø¨Ù‡ Ø´Ù…Ø§Ø±Ù‡ Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯', 'success');
                } else {
                    showNotification('Ø®Ø·Ø§', data.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯', 'error');
                }
            })
            .catch(error => {
                showLoading(false);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
                console.error('Error:', error);
            });
        }

        function moveToNext(input, nextIndex) {
            if (input.value.length === 1 && nextIndex <= 5) {
                const nextInput = input.parentElement.querySelector(`.otp-input:nth-child(${nextIndex})`);
                if (nextInput) nextInput.focus();
            }
        }

        function verifyOTP() {
            const phone = document.getElementById('phoneNumber').value.trim();
            const otpInputs = document.querySelectorAll('.otp-input');
            let code = '';
            otpInputs.forEach(input => code += input.value);
            
            if (code.length !== 5) {
                showNotification('Ø®Ø·Ø§', 'Ù„Ø·ÙØ§Ù‹ Ú©Ø¯ Ûµ Ø±Ù‚Ù…ÛŒ Ø±Ø§ Ú©Ø§Ù…Ù„ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }

            showLoading(true);
            
            fetch('/api/auth/verify-otp', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ phone: phone, code: code })
            })
            .then(response => response.json())
            .then(data => {
                showLoading(false);
                
                if (data.success && data.token) {
                    authToken = data.token;
                    currentUser = data.user;
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ø³ÛŒØ³ØªÙ… Ø§ØµÙ„ÛŒ
                    document.getElementById('authContainer').style.display = 'none';
                    document.getElementById('mainContainer').style.display = 'block';
                    
                    // Ø¢Ù¾Ø¯ÛŒØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
                    document.getElementById('userName').textContent = currentUser.name || `Ú©Ø§Ø±Ø¨Ø± ${currentUser.phone}`;
                    document.getElementById('userPhoneDisplay').textContent = currentUser.phone;
                    
                    // Ø§ØªØµØ§Ù„ WebSocket
                    connectWebSocket();
                    
                    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                    loadDashboardData();
                    loadCustomers();
                    loadInvoices();
                    loadProducts();
                    
                    showNotification('Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯', 'ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯', 'success');
                } else {
                    showNotification('Ø®Ø·Ø§', data.error || 'Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª', 'error');
                }
            })
            .catch(error => {
                showLoading(false);
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
                console.error('Error:', error);
            });
        }

        function resendOTP() {
            showNotification('Ø§Ø·Ù„Ø§Ø¹', 'Ú©Ø¯ Ø¬Ø¯ÛŒØ¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯', 'success');
        }

        // ==================== WebSocket ====================
        function connectWebSocket() {
            socket = io('http://localhost:5000', {
                transports: ['websocket', 'polling'],
                auth: {
                    token: authToken
                }
            });

            socket.on('connect', () => {
                console.log('âœ… Ù…ØªØµÙ„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ú†Øª');
                showNotification('Ø³ÛŒØ³ØªÙ…', 'Ø§ØªØµØ§Ù„ Ú†Øª Ø¨Ø±Ù‚Ø±Ø§Ø± Ø´Ø¯', 'success');
            });

            socket.on('authenticated', (data) => {
                console.log('Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª WebSocket Ù…ÙˆÙÙ‚:', data);
            });

            socket.on('new_message', (data) => {
                if (currentChatRoom === data.room_id) {
                    addMessageToChat(data);
                } else {
                    showNotification('Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯', `Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ù…Ø´ØªØ±ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯`, 'info');
                }
            });

            socket.on('file_uploaded', (data) => {
                if (currentChatRoom === data.room_id) {
                    addFileMessageToChat(data);
                }
            });

            socket.on('new_invoice', (data) => {
                showNotification('ÙØ§Ú©ØªÙˆØ± Ø¬Ø¯ÛŒØ¯', `ÙØ§Ú©ØªÙˆØ± Ø´Ù…Ø§Ø±Ù‡ ${data.invoice_number} Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯`, 'success');
                loadInvoices();
            });

            socket.on('check_reminder', (data) => {
                showNotification('ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ú†Ú©', `Ú†Ú© Ø´Ù…Ø§Ø±Ù‡ ${data.check_number} ÙØ±Ø¯Ø§ Ø³Ø±Ø±Ø³ÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯`, 'warning');
            });
        }

        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø®Ø´â€ŒÙ‡Ø§ ====================
        function showSection(sectionId) {
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¨Ø®Ø´â€ŒÙ‡Ø§
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ø§ÙˆØ¨Ø±ÛŒ
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            document.getElementById(sectionId + 'Section').classList.add('active');
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ù†Ø§ÙˆØ¨Ø±ÛŒ
            const navBtn = Array.from(document.querySelectorAll('.nav-btn')).find(btn => 
                btn.textContent.includes(sectionId === 'dashboard' ? 'Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯' :
                sectionId === 'customers' ? 'Ù…Ø´ØªØ±ÛŒØ§Ù†' :
                sectionId === 'invoices' ? 'ÙØ§Ú©ØªÙˆØ±Ù‡Ø§' :
                sectionId === 'products' ? 'Ù…Ø­ØµÙˆÙ„Ø§Øª' :
                sectionId === 'checks' ? 'Ú†Ú©â€ŒÙ‡Ø§' :
                sectionId === 'chat' ? 'Ú†Øª Ø¢Ù†Ù„Ø§ÛŒÙ†' :
                sectionId === 'reports' ? 'Ú¯Ø²Ø§Ø±Ø´Ø§Øª' :
                sectionId === 'settings' ? 'ØªÙ†Ø¸ÛŒÙ…Ø§Øª' : '')
            );
            
            if (navBtn) {
                navBtn.classList.add('active');
            }
        }

        // ==================== Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ====================
        function loadDashboardData() {
            fetch('/api/transactions', {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateDashboardStats(data.stats);
                    updateRecentTransactions(data.transactions.slice(0, 10));
                }
            })
            .catch(error => console.error('Error loading dashboard:', error));
        }

        function updateDashboardStats(stats) {
            document.getElementById('todayIncome').textContent = formatCurrency(stats.total_income);
            document.getElementById('todayExpense').textContent = formatCurrency(stats.total_expense);
            document.getElementById('todayProfit').textContent = formatCurrency(stats.net_profit);
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø±ØµØ¯ ØªØºÛŒÛŒØ±Ø§Øª
            const incomeChange = stats.total_income > 0 ? 15 : 0;
            const expenseChange = stats.total_expense > 0 ? -8 : 0;
            const profitChange = stats.net_profit > 0 ? 23 : 0;
            
            document.getElementById('incomeChange').textContent = `${incomeChange}Ùª`;
            document.getElementById('expenseChange').textContent = `${expenseChange}Ùª`;
            document.getElementById('profitChange').textContent = `${profitChange}Ùª`;
        }

        function updateRecentTransactions(transactions) {
            const tbody = document.getElementById('recentTransactions');
            tbody.innerHTML = '';
            
            if (transactions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-inbox"></i>
                            <p style="margin-top: 10px;">ØªØ±Ø§Ú©Ù†Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            transactions.forEach((transaction, index) => {
                const isIncome = transaction.type === 'income';
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${formatDate(transaction.date)}</td>
                    <td>
                        <span class="tag ${isIncome ? 'tag-success' : 'tag-danger'}">
                            ${isIncome ? 'Ø¯Ø±Ø¢Ù…Ø¯' : 'Ù‡Ø²ÛŒÙ†Ù‡'}
                        </span>
                    </td>
                    <td>${transaction.description || 'Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­'}</td>
                    <td style="font-weight: 900; color: ${isIncome ? '#2d9a0f' : '#f72585'}">
                        ${isIncome ? '+' : '-'}${formatCurrency(transaction.amount)}
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn btn-view" onclick="viewTransaction(${transaction.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn btn-delete" onclick="deleteTransaction(${transaction.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadTransactions() {
            showNotification('Ø§Ø·Ù„Ø§Ø¹', 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§...', 'info');
            loadDashboardData();
        }

        // ==================== Ù…Ø´ØªØ±ÛŒØ§Ù† ====================
        function loadCustomers() {
            fetch('/api/customers', {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateCustomersTable(data.customers);
                    updateCustomerDropdowns(data.customers);
                }
            })
            .catch(error => console.error('Error loading customers:', error));
        }

        function updateCustomersTable(customers) {
            const tbody = document.getElementById('customersTable');
            tbody.innerHTML = '';
            
            if (customers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-users"></i>
                            <p style="margin-top: 10px;">Ù…Ø´ØªØ±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
                            <button class="btn btn-sm btn-primary" onclick="showAddCustomerModal()" style="margin-top: 15px;">
                                Ø§ÙØ²ÙˆØ¯Ù† Ø§ÙˆÙ„ÛŒÙ† Ù…Ø´ØªØ±ÛŒ
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            customers.forEach((customer, index) => {
                const row = document.createElement('tr');
                const balance = customer.balance || 0;
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td style="font-weight: 900;">${customer.name}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.email || '-'}</td>
                    <td style="font-weight: 900; color: ${balance >= 0 ? '#2d9a0f' : '#f72585'}">
                        ${formatCurrency(balance)}
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn btn-edit" onclick="editCustomer(${customer.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn btn-delete" onclick="deleteCustomer(${customer.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="action-btn btn-view" onclick="chatWithCustomer(${customer.id}, '${customer.name}')">
                                <i class="fas fa-comment"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateCustomerDropdowns(customers) {
            const invoiceSelect = document.getElementById('invoiceCustomer');
            const chatSelect = document.getElementById('chatCustomer');
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† options Ù‚Ø¨Ù„ÛŒ (Ø¨Ù‡ Ø¬Ø² option Ø§ÙˆÙ„)
            while (invoiceSelect.options.length > 1) invoiceSelect.remove(1);
            while (chatSelect.options.length > 1) chatSelect.remove(1);
            
            customers.forEach(customer => {
                const option1 = document.createElement('option');
                option1.value = customer.id;
                option1.textContent = `${customer.name} - ${customer.phone}`;
                invoiceSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = customer.id;
                option2.textContent = `${customer.name} - ${customer.phone}`;
                chatSelect.appendChild(option2);
            });
        }

        function showAddCustomerModal() {
            document.getElementById('addCustomerModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function saveCustomer() {
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const email = document.getElementById('customerEmail').value.trim();
            const address = document.getElementById('customerAddress').value.trim();
            
            if (!name || !phone) {
                showNotification('Ø®Ø·Ø§', 'Ù†Ø§Ù… Ùˆ Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ø§Ù„Ø²Ø§Ù…ÛŒ Ù‡Ø³ØªÙ†Ø¯', 'error');
                return;
            }

            fetch('/api/customers', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify({
                    name: name,
                    phone: phone,
                    email: email,
                    address: address
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Ù…ÙˆÙÙ‚', 'Ù…Ø´ØªØ±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯', 'success');
                    closeModal('addCustomerModal');
                    loadCustomers();
                    
                    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
                    document.getElementById('customerName').value = '';
                    document.getElementById('customerPhone').value = '';
                    document.getElementById('customerEmail').value = '';
                    document.getElementById('customerAddress').value = '';
                } else {
                    showNotification('Ø®Ø·Ø§', data.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ù…Ø´ØªØ±ÛŒ', 'error');
                }
            })
            .catch(error => {
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
                console.error('Error:', error);
            });
        }

        function deleteCustomer(customerId) {
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ù…Ø´ØªØ±ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) return;
            
            fetch(`/api/customers/${customerId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Ù…ÙˆÙÙ‚', 'Ù…Ø´ØªØ±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯', 'success');
                    loadCustomers();
                } else {
                    showNotification('Ø®Ø·Ø§', data.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù…Ø´ØªØ±ÛŒ', 'error');
                }
            })
            .catch(error => {
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
                console.error('Error:', error);
            });
        }

        function searchCustomers(query) {
            const rows = document.querySelectorAll('#customersTable tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query.toLowerCase()) ? '' : 'none';
            });
        }

        function editCustomer(customerId) {
            showNotification('Ø§Ø·Ù„Ø§Ø¹', 'ÙˆÛŒÚ˜Ú¯ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ø¯Ø± Ù†Ø³Ø®Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯', 'info');
        }

        // ==================== ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ ====================
        function addInvoiceItem() {
            const container = document.getElementById('invoiceItems');
            const newItem = document.createElement('div');
            newItem.className = 'invoice-item';
            newItem.innerHTML = `
                <input type="text" class="item-input" placeholder="Ù†Ø§Ù… Ú©Ø§Ù„Ø§" oninput="calculateInvoice()">
                <input type="number" class="item-input" placeholder="ØªØ¹Ø¯Ø§Ø¯" style="width: 120px;" oninput="calculateInvoice()">
                <input type="number" class="item-input" placeholder="Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯" style="width: 150px;" oninput="calculateInvoice()">
                <input type="number" class="item-input" placeholder="ØªØ®ÙÛŒÙ %" style="width: 100px;" oninput="calculateInvoice()">
                <button class="action-btn btn-delete" onclick="removeInvoiceItem(this)">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(newItem);
        }

        function removeInvoiceItem(button) {
            button.closest('.invoice-item').remove();
            calculateInvoice();
        }

        function calculateInvoice() {
            let subtotal = 0;
            const items = document.querySelectorAll('.invoice-item');
            
            items.forEach(item => {
                const inputs = item.querySelectorAll('.item-input');
                const quantity = parseFloat(inputs[1].value) || 0;
                const price = parseFloat(inputs[2].value) || 0;
                const discount = parseFloat(inputs[3].value) || 0;
                
                const itemTotal = quantity * price;
                const itemDiscount = itemTotal * (discount / 100);
                subtotal += itemTotal - itemDiscount;
            });
            
            // Ù†Ù…Ø§ÛŒØ´ Ù…Ø¨Ù„Øº
            document.getElementById('invoiceTotal').textContent = formatCurrency(subtotal);
            
            // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø­Ø±ÙˆÙ
            document.getElementById('invoiceTotalWords').textContent = 
                numberToWords(Math.floor(subtotal)) + ' ØªÙˆÙ…Ø§Ù†';
        }

        function numberToWords(num) {
            const units = ['', 'ÛŒÚ©', 'Ø¯Ùˆ', 'Ø³Ù‡', 'Ú†Ù‡Ø§Ø±', 'Ù¾Ù†Ø¬', 'Ø´Ø´', 'Ù‡ÙØª', 'Ù‡Ø´Øª', 'Ù†Ù‡'];
            const teens = ['Ø¯Ù‡', 'ÛŒØ§Ø²Ø¯Ù‡', 'Ø¯ÙˆØ§Ø²Ø¯Ù‡', 'Ø³ÛŒØ²Ø¯Ù‡', 'Ú†Ù‡Ø§Ø±Ø¯Ù‡', 'Ù¾Ø§Ù†Ø²Ø¯Ù‡', 'Ø´Ø§Ù†Ø²Ø¯Ù‡', 'Ù‡ÙØ¯Ù‡', 'Ù‡Ø¬Ø¯Ù‡', 'Ù†ÙˆØ²Ø¯Ù‡'];
            const tens = ['', '', 'Ø¨ÛŒØ³Øª', 'Ø³ÛŒ', 'Ú†Ù‡Ù„', 'Ù¾Ù†Ø¬Ø§Ù‡', 'Ø´ØµØª', 'Ù‡ÙØªØ§Ø¯', 'Ù‡Ø´ØªØ§Ø¯', 'Ù†ÙˆØ¯'];
            const hundreds = ['', 'ØµØ¯', 'Ø¯ÙˆÛŒØ³Øª', 'Ø³ÛŒØµØ¯', 'Ú†Ù‡Ø§Ø±ØµØ¯', 'Ù¾Ø§Ù†ØµØ¯', 'Ø´Ø´ØµØ¯', 'Ù‡ÙØªØµØ¯', 'Ù‡Ø´ØªØµØ¯', 'Ù†Ù‡ØµØ¯'];
            
            if (num === 0) return 'ØµÙØ±';
            
            let result = '';
            
            // Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯
            if (num >= 1000000000) {
                result += numberToWords(Math.floor(num / 1000000000)) + ' Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯ Ùˆ ';
                num %= 1000000000;
            }
            
            // Ù…ÛŒÙ„ÛŒÙˆÙ†
            if (num >= 1000000) {
                result += numberToWords(Math.floor(num / 1000000)) + ' Ù…ÛŒÙ„ÛŒÙˆÙ† Ùˆ ';
                num %= 1000000;
            }
            
            // Ù‡Ø²Ø§Ø±
            if (num >= 1000) {
                result += numberToWords(Math.floor(num / 1000)) + ' Ù‡Ø²Ø§Ø± Ùˆ ';
                num %= 1000;
            }
            
            // ØµØ¯
            if (num >= 100) {
                result += hundreds[Math.floor(num / 100)] + ' Ùˆ ';
                num %= 100;
            }
            
            // Ø¯Ù‡ Ùˆ ÛŒÚ©Ø§Ù†
            if (num > 0) {
                if (num < 10) {
                    result += units[num];
                } else if (num < 20) {
                    result += teens[num - 10];
                } else {
                    result += tens[Math.floor(num / 10)];
                    if (num % 10 > 0) {
                        result += ' Ùˆ ' + units[num % 10];
                    }
                }
            }
            
            // Ø­Ø°Ù ' Ùˆ ' Ø§Ø¶Ø§ÙÛŒ
            if (result.endsWith(' Ùˆ ')) {
                result = result.slice(0, -3);
            }
            
            return result;
        }

        function saveInvoice() {
            const customerId = document.getElementById('invoiceCustomer').value;
            const invoiceDate = document.getElementById('invoiceDate').value || new Date().toISOString().split('T')[0];
            
            if (!customerId) {
                showNotification('Ø®Ø·Ø§', 'Ù„Ø·ÙØ§Ù‹ Ù…Ø´ØªØ±ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø§Ù‚Ù„Ø§Ù…
            const items = [];
            const itemElements = document.querySelectorAll('.invoice-item');
            
            itemElements.forEach(item => {
                const inputs = item.querySelectorAll('.item-input');
                const productName = inputs[0].value.trim();
                const quantity = parseFloat(inputs[1].value) || 0;
                const unitPrice = parseFloat(inputs[2].value) || 0;
                const discount = parseFloat(inputs[3].value) || 0;
                
                if (productName && quantity > 0 && unitPrice > 0) {
                    items.push({
                        product_name: productName,
                        quantity: quantity,
                        unit_price: unitPrice,
                        discount: discount
                    });
                }
            });
            
            if (items.length === 0) {
                showNotification('Ø®Ø·Ø§', 'Ù„Ø·ÙØ§Ù‹ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ú©Ø§Ù„Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }

            fetch('/api/invoices', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify({
                    customer_id: customerId,
                    invoice_date: invoiceDate,
                    items: items
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Ù…ÙˆÙÙ‚', `ÙØ§Ú©ØªÙˆØ± Ø´Ù…Ø§Ø±Ù‡ ${data.invoice_number} Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯`, 'success');
                    clearInvoiceForm();
                    loadInvoices();
                } else {
                    showNotification('Ø®Ø·Ø§', data.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ ÙØ§Ú©ØªÙˆØ±', 'error');
                }
            })
            .catch(error => {
                showNotification('Ø®Ø·Ø§', 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
                console.error('Error:', error);
            });
        }

        function clearInvoiceForm() {
            const itemsContainer = document.getElementById('invoiceItems');
            itemsContainer.innerHTML = `
                <div class="invoice-item">
                    <input type="text" class="item-input" placeholder="Ù†Ø§Ù… Ú©Ø§Ù„Ø§" oninput="calculateInvoice()">
                    <input type="number" class="item-input" placeholder="ØªØ¹Ø¯Ø§Ø¯" style="width: 120px;" oninput="calculateInvoice()">
                    <input type="number" class="item-input" placeholder="Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯" style="width: 150px;" oninput="calculateInvoice()">
                    <input type="number" class="item-input" placeholder="ØªØ®ÙÛŒÙ %" style="width: 100px;" oninput="calculateInvoice()">
                    <button class="action-btn btn-delete" onclick="removeInvoiceItem(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            document.getElementById('invoiceCustomer').value = '';
            document.getElementById('invoiceDate').value = '';
            calculateInvoice();
        }

        function loadInvoices() {
            fetch('/api/invoices', {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateInvoicesTable(data.invoices);
                }
            })
            .catch(error => console.error('Error loading invoices:', error));
        }

        function updateInvoicesTable(invoices) {
            const tbody = document.getElementById('invoicesTable');
            tbody.innerHTML = '';
            
            if (invoices.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-file-invoice"></i>
                            <p style="margin-top: 10px;">ÙØ§Ú©ØªÙˆØ±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            invoices.forEach((invoice, index) => {
                const statusClass = 
                    invoice.status === 'paid' ? 'tag-success' :
                    invoice.status === 'pending' ? 'tag-warning' : 'tag-danger';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="font-weight: 900;">${invoice.invoice_number}</td>
                    <td>${formatDate(invoice.invoice_date)}</td>
                    <td>${invoice.customer_name || 'Ø¨Ø¯ÙˆÙ† Ù…Ø´ØªØ±ÛŒ'}</td>
                    <td style="font-weight: 900;">${formatCurrency(invoice.total_amount)}</td>
                    <td><span class="tag ${statusClass}">${invoice.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn btn-view" onclick="viewInvoice(${invoice.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn btn-download" onclick="downloadInvoice(${invoice.id})">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="action-btn btn-delete" onclick="deleteInvoice(${invoice.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function downloadInvoiceImage() {
            showNotification('Ø§Ø·Ù„Ø§Ø¹', 'Ø¯Ø± Ø­Ø§Ù„ Ø§ÛŒØ¬Ø§Ø¯ Ø¹Ú©Ø³ ÙØ§Ú©ØªÙˆØ±...', 'info');
            // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§ÛŒØ¯ Ø¨Ø§ html2canvas Ø¹Ú©Ø³ Ú¯Ø±ÙØªÙ‡ Ø´ÙˆØ¯
        }

        function sendInvoice() {
            showNotification('Ø§Ø·Ù„Ø§Ø¹', 'ÙØ§Ú©ØªÙˆØ± Ø¨Ø±Ø§ÛŒ Ù…Ø´ØªØ±ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯', 'success');
        }

        function printInvoice() {
            window.print();
        }

        // ==================== Ú†Øª Ø¢Ù†Ù„Ø§ÛŒÙ† ====================
        function chatWithCustomer(customerId, customerName) {
            showSection('chat');
            
            // Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ Ø¯Ø± dropdown
            document.getElementById('chatCustomer').value = customerId;
            
            // Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø§ØªØ§Ù‚ Ú†Øª
            currentChatRoom = `chat_${currentUser.id}_${customerId}`;
            
            if (socket) {
                socket.emit('join_chat', {
                    user_id: currentUser.id,
                    customer_id: customerId
                });
                
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú†Øª
                loadChatHistory(customerId);
            }
            
            showNotification('Ú†Øª', `Ú¯ÙØªÚ¯Ùˆ Ø¨Ø§ ${customerName} Ø´Ø±ÙˆØ¹ Ø´Ø¯`, 'info');
        }

        function loadChatHistory(customerId) {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = '';
            
            // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§ÛŒØ¯ Ø§Ø² API ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú†Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´ÙˆØ¯
            // ÙØ¹Ù„Ø§Ù‹ ÛŒÚ© Ù¾ÛŒØ§Ù… Ù†Ù…Ø§ÛŒØ´ÛŒ
            messagesContainer.innerHTML = `
                <div style="text-align: center; color: var(--gray); padding: 20px;">
                    <i class="fas fa-comments" style="font-size: 32px; margin-bottom: 10px;"></i>
                    <p>ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú†Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯...</p>
                </div>
            `;
        }

        function sendChatMessage() {
            const messageInput = document.getElementById('chatMessageInput');
            const message = messageInput.value.trim();
            const customerId = document.getElementById('chatCustomer').value;
            
            if (!message || !customerId) {
                showNotification('Ø®Ø·Ø§', 'Ù„Ø·ÙØ§Ù‹ Ù…Ø´ØªØ±ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ùˆ Ù¾ÛŒØ§Ù…ÛŒ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯', 'error');
                return;
            }
            
            if (socket) {
                socket.emit('send_message', {
                    user_id: currentUser.id,
                    customer_id: customerId,
                    message: message,
                    type: 'text'
                });
                
                // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø¯Ø± Ú†Øª
                addMessageToChat({
                    room_id: currentChatRoom,
                    sender_id: currentUser.id,
                    sender_type: 'user',
                    message_type: 'text',
                    message_content: message,
                    timestamp: new Date().toISOString()
                });
                
                messageInput.value = '';
                messageInput.focus();
            }
        }

        function addMessageToChat(message) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            
            const isSent = message.sender_type === 'user';
            messageDiv.className = `message ${isSent ? 'sent' : 'received'}`;
            
            const time = new Date(message.timestamp).toLocaleTimeString('fa-IR', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            messageDiv.innerHTML = `
                <div>${message.message_content}</div>
                <div class="message-time">${time}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function uploadFileToChat(input) {
            const file = input.files[0];
            if (!file) return;
            
            const customerId = document.getElementById('chatCustomer').value;
            if (!customerId) {
                showNotification('Ø®Ø·Ø§', 'Ù„Ø·ÙØ§Ù‹ Ù…Ø´ØªØ±ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Data = e.target.result.split(',')[1];
                
                if (socket) {
                    socket.emit('upload_file', {
                        user_id: currentUser.id,
                        customer_id: customerId,
                        file_data: base64Data,
                        file_name: file.name,
                        file_type: file.type
                    });
                    
                    addFileMessageToChat({
                        file_name: file.name,
                        file_type: file.type,
                        file_size: file.size,
                        sender_id: currentUser.id,
                        timestamp: new Date().toISOString()
                    });
                }
            };
            reader.readAsDataURL(file);
        }

        function addFileMessageToChat(fileData) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message sent';
            
            const time = new Date(fileData.timestamp).toLocaleTimeString('fa-IR', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const fileSize = formatFileSize(fileData.file_size);
            const icon = fileData.file_type.startsWith('image/') ? 'fas fa-image' : 'fas fa-file';
            
            messageDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="${icon}" style="font-size: 24px;"></i>
                    <div>
                        <div style="font-weight: 900;">${fileData.file_name}</div>
                        <div style="font-size: 12px; opacity: 0.8;">${fileSize}</div>
                    </div>
                </div>
                <div class="message-time">${time}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // ==================== Ù…Ø­ØµÙˆÙ„Ø§Øª ====================
        function loadProducts() {
            fetch('/api/products', {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateProductsTable(data.products);
                }
            })
            .catch(error => console.error('Error loading products:', error));
        }

        function updateProductsTable(products) {
            const tbody = document.getElementById('productsTable');
            tbody.innerHTML = '';
            
            if (products.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-boxes"></i>
                            <p style="margin-top: 10px;">Ù…Ø­ØµÙˆÙ„ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            products.forEach((product, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td style="font-weight: 900;">${product.name}</td>
                    <td><span class="tag tag-primary">${product.category || 'Ø¹Ù…ÙˆÙ…ÛŒ'}</span></td>
                    <td>${product.stock_quantity} ${product.unit}</td>
                    <td>${formatCurrency(product.buy_price)}</td>
                    <td style="font-weight: 900; color: var(--primary);">${formatCurrency(product.sell_price)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn btn-edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn btn-delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function filterProducts(category) {
            // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ù…Ø­ØµÙˆÙ„Ø§Øª
            showNotification('Ø§Ø·Ù„Ø§Ø¹', `ÙÛŒÙ„ØªØ± Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ: ${category}`, 'info');
        }

        function showAddProductModal() {
            showNotification('Ø§Ø·Ù„Ø§Ø¹', 'ÙˆÛŒÚ˜Ú¯ÛŒ Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¯Ø± Ù†Ø³Ø®Ù‡ Ø¨Ø¹Ø¯ÛŒ', 'info');
        }

        // ==================== Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ú©Ù…Ú©ÛŒ ====================
        function formatCurrency(amount) {
            return new Intl.NumberFormat('fa-IR', {
                style: 'currency',
                currency: 'IRR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount).replace('Ø±ÛŒØ§Ù„', 'ØªÙˆÙ…Ø§Ù†');
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('fa-IR');
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Ø¨Ø§ÛŒØª';
            const k = 1024;
            const sizes = ['Ø¨Ø§ÛŒØª', 'Ú©ÛŒÙ„ÙˆØ¨Ø§ÛŒØª', 'Ù…Ú¯Ø§Ø¨Ø§ÛŒØª', 'Ú¯ÛŒÚ¯Ø§Ø¨Ø§ÛŒØª'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function showUserMenu() {
            showNotification('Ù…Ù†ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±', 'ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ù†Ø³Ø®Ù‡ Ø¨Ø¹Ø¯ÛŒ', 'info');
        }

        // ==================== Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ====================
        document.addEventListener('DOMContentLoaded', function() {
            // ØªÙ†Ø¸ÛŒÙ… ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ²
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('invoiceDate').value = today;
            
            // Ù†Ù…Ø§ÛŒØ´ Ù„ÙˆØ¯ÛŒÙ†Ú¯ Ø§ÙˆÙ„ÛŒÙ‡
            showLoading(false);
            
            console.log('ğŸš€ Ø³ÛŒØ³ØªÙ… Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª');
        });
    </script>
</body>
  </html>
